<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>NVSSPI25X.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link id="favicon" rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="tiapistylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table width="100%">
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border="0" src="tilogo.gif" /></a></td>
  <td bgcolor="red"><img src="titagline.gif" /></td>
</tr>
</table>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_2298ed0e5bfee6f293aea6c715ac7f7c.html">exports</a></li><li class="navelem"><a class="el" href="dir_1395dc6568e73d67e90e363c4035e4f6.html">tidrivers_msp432</a></li><li class="navelem"><a class="el" href="dir_2ad5680906f12c9eddf121ba68442a90.html">source</a></li><li class="navelem"><a class="el" href="dir_0da705fc44f28017c66964e8e9f342d2.html">ti</a></li><li class="navelem"><a class="el" href="dir_5cee8d03ec8e05f2dc78c474d8f4ba05.html">drivers</a></li><li class="navelem"><a class="el" href="dir_d7ab458cd341c2b0bde9ac65e38c0276.html">nvs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">NVSSPI25X.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Non-Volatile Storage driver implementation for SPI flash peripherals. </p>
<hr/>
<h1>Overview</h1>
<p>The NVSSPI25X module allows you to manage SPI flash memory. This driver works with most 256 byte/page SPI flash memory devices such as: </p><pre class="fragment">Winbond     W25xx   family
Macronics   MX25Rxx family
Micron      N25Qxx  family
</pre><p>The SPI flash commands used by this driver are as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SPIFLASH_PAGE_WRITE       0x02 // Page Program (up to 256 bytes)</span></div><div class="line"><span class="preprocessor">#define SPIFLASH_READ             0x03 // Read Data</span></div><div class="line"><span class="preprocessor">#define SPIFLASH_READ_STATUS      0x05 // Read Status Register</span></div><div class="line"><span class="preprocessor">#define SPIFLASH_WRITE_ENABLE     0x06 // Write Enable</span></div><div class="line"><span class="preprocessor">#define SPIFLASH_SUBSECTOR_ERASE  0x20 // SubSector (4K bytes) Erase</span></div><div class="line"><span class="preprocessor">#define SPIFLASH_SECTOR_ERASE     0xD8 // Sector (usually 64K bytes) Erase</span></div><div class="line"><span class="preprocessor">#define SPIFLASH_RDP              0xAB // Release from Deep Power Down</span></div><div class="line"><span class="preprocessor">#define SPIFLASH_DP               0xB9 // Deep Power Down</span></div><div class="line"><span class="preprocessor">#define SPIFLASH_MASS_ERASE       0xC7 // Erase entire flash.</span></div></div><!-- fragment --><p>It is assumed that the SPI flash device used by this driver supports the byte programmability of the SPIFLASH_PAGE_WRITE command and that write page size is 256 bytes. The erase sector and subsector sizes are assumed to be 64K and 4K respectively.</p>
<p>The <a class="el" href="_n_v_s_8h.html#a4f309d160ac4641c89501adc95d170b3" title="Erase size bytes of the region beginning at offset bytes from the base of the region referenced by th...">NVS_erase()</a> command will issue a sector or subsector erase command based on the input size and offset.</p>
<p>The driver must query the SPI flash to ensure that the part is ready before commands are issued. If the part responds as busy, the poll function sleeps for a number of microseconds determined by the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#a0babde38f1743458205b95c316363e80" title="External Flash Status Poll Delay. ">NVSSPI25X_HWAttrs.statusPollDelayUs</a> field. A value of 0 means that the driver will continuously poll the external flash until it is ready, which may affect other threads ability to execute.</p>
<h2>SPI Interface Management</h2>
<p>For each managed flash region, a corresponding SPI instance must be provided to the NVSSPI25X driver.</p>
<p>The SPI instance can be opened and closed internally by the NVSSPI25X driver, or alternatively, a SPI handle can be provided to the NVSSPI25X driver, indicating that the SPI instance is being opened and closed elsewhere within the application. This mode is useful when the SPI bus is share by more than just the SPI flash device.</p>
<p>If the SPI instance is to be managed internally by the NVSSPI25X driver, a SPI instance index and bit rate must be configured in the region's HWAttrs. If the same SPI instance is referenced by multiple flash regions the driver will ensure that <a class="el" href="_s_p_i_8h.html#a9c9022decfb136991d6b53f7dd2ae2fc" title="This function opens a given SPI peripheral. ">SPI_open()</a> is invoked only once, and that <a class="el" href="_s_p_i_8h.html#a0e3448b30b88609fa120915e49560601" title="Function to close a SPI peripheral specified by the SPI handle. ">SPI_close()</a> will only be invoked when all flash regions using the SPI instance have been closed.</p>
<p>If the SPI bus that the SPI flash device is on is shared with other devices accessed by an application, then the SPI handle used to manage a SPI flash region can be provided in the region's HWAttrs "spiHandle" field. Keep in mind that the "spiHandle" field is a POINTER to a SPI Handle, NOT a SPI Handle. This allows the user to simply initialize this field with the name of the global variable used for the SPI handle. In this mode, the user MUST open the SPI instance prior to opening the NVS region instance so that the referenced spiHandle is valid.</p>
<p>By default, the "spiHandle" field is set to NULL, indicating that the user expects the NVS driver to open and close the SPI instance internally using the 'spiIndex' and 'spiBitRate' provided in the HWAttrs.</p>
<h2><a class="anchor" id="SPI_CS_MGMT"></a>SPI Flash Chip Select Management</h2>
<h3>Option 1: NVSSPI25X Driver Manages Chip Select</h3>
<p>By default, the NVSSPI25X driver will assert and de-assert a GPIO driver managed pin to select the SPI flash device before and after each SPI transfer to and from the device.</p>
<p>To enable this behavior, a valid GPIO driver instance index must be provided in the NVS region's <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#ade20d02364fd0f77d795295f4b85d363">spiCsnGpioIndex</a> field of the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html" title="NVSSPI25X attributes. ">NVSSPI25X_HWAttrs</a> structure. The corresponding GPIO pin will be configured at runtime by the NVSSPI25X driver as "GPIO_CFG_OUT_STD" and assertion of this pin is assumed to be active LOW.</p>
<h3>Option 2: SPI Driver Manages Chip Select</h3>
<p>Some SPI peripherals can be configured to manage their own chip select. Setting the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#ade20d02364fd0f77d795295f4b85d363">spiCsnGpioIndex</a> field of the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html" title="NVSSPI25X attributes. ">NVSSPI25X_HWAttrs</a> structure to <a class="el" href="_n_v_s_s_p_i25_x_8h.html#abf8ed123f5292601fe76a62275bb60f9" title="Disable internal management of SPI chip select. ">NVSSPI25X_SPI_MANAGES_CS</a> informs the NVSSPI25X driver that the SPI peripheral used by the NVS driver has been configured that way.</p>
<h3>Option 3: User Manages Chip Select</h3>
<p>Alternatively, the user can manage the assertion and de-assertion of the SPI flash chip select entirely themselves by providing implementations of the following 4 APIs in their application code:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> NVSSPI25X_initSpiCs(<a class="code" href="struct_n_v_s___config__.html">NVS_Handle</a> nvsHandle, uint16_t csId);</div></div><!-- fragment --><ul>
<li>This function is invoked within the <a class="el" href="_n_v_s_8h.html#a15488564c98e00aa62400a54dde3d44e" title="Open an NVS region for reading and writing. ">NVS_open()</a> API and is where the user should do whatever is required to initialize the hardware used for asserting and de-assering the SPI chip select signal.</li>
<li>The 'nvsHandle` argument is the NVS handle associated with the corresponding NVS region.</li>
<li>The 'csId' argument passed to this API is a copy of the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#ade20d02364fd0f77d795295f4b85d363">spiCsnGpioIndex</a> field of the corresponding NVS region's <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html" title="NVSSPI25X attributes. ">NVSSPI25X_HWAttrs</a> structure.</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> NVSSPI25X_deinitSpiCs(<a class="code" href="struct_n_v_s___config__.html">NVS_Handle</a> nvsHandle, uint16_t csId);</div></div><!-- fragment --><ul>
<li>This function is invoked within the <a class="el" href="_n_v_s_8h.html#a12147fcc41f532802d97c0784c3e30c3" title="Function to close an NVS_Handle. ">NVS_close()</a> API and is where the user should do whatever is required to de-initialize the hardware used for asserting and de-assering the SPI chip select signal.</li>
<li>The 'nvsHandle` argument is the NVS handle associated with the corresponding NVS region.</li>
<li>The 'csId' argument passed to this API is a copy of the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#ade20d02364fd0f77d795295f4b85d363">spiCsnGpioIndex</a> field of the corresponding NVS region's <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html" title="NVSSPI25X attributes. ">NVSSPI25X_HWAttrs</a> structure.</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> NVSSPI25X_assertSpiCs(<a class="code" href="struct_n_v_s___config__.html">NVS_Handle</a> nvsHandle, uint16_t csId);</div></div><!-- fragment --><ul>
<li>This function is called PRIOR to every SPI transfer to and from the SPI flash device performed by the NVSSPI25X driver. The user code should perform the corresponding action required to select the SPI flash device to prepare for the SPI transfer.</li>
<li>The 'nvsHandle` argument is the NVS handle associated with the corresponding NVS region.</li>
<li>The 'csId' argument passed to this API is a copy of the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#ade20d02364fd0f77d795295f4b85d363">spiCsnGpioIndex</a> field of the corresponding NVS region's <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html" title="NVSSPI25X attributes. ">NVSSPI25X_HWAttrs</a> structure.</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> NVSSPI25X_deassertSpiCs(<a class="code" href="struct_n_v_s___config__.html">NVS_Handle</a> nvsHandle, uint16_t csId);</div></div><!-- fragment --><ul>
<li>This function is called AFTER every SPI transfer to and from the SPI flash device performed by the NVSSPI25X driver. The user code should perform the corresponding action required to de-select the SPI flash device. following the SPI transfer.</li>
<li>The 'nvsHandle` argument is the NVS handle associated with the corresponding NVS region.</li>
<li>The 'csId' argument passed to this API is a copy of the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#ade20d02364fd0f77d795295f4b85d363">spiCsnGpioIndex</a> field of the corresponding NVS region's <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html" title="NVSSPI25X attributes. ">NVSSPI25X_HWAttrs</a> structure.</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>All 4 of the above APIs must be provided by the user if this option is used, otherwise default internal implementations of the APIs will be called that will likely lead to application failure. </dd></dl>
</div><div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;<a class="el" href="_s_p_i_8h_source.html">ti/drivers/SPI.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for NVSSPI25X.h:</div>
<div class="dyncontent">
<div class="center"><img src="_n_v_s_s_p_i25_x_8h__incl.png" border="0" usemap="#_n_v_s_s_p_i25_x_8h" alt=""/></div>
<map name="_n_v_s_s_p_i25_x_8h" id="_n_v_s_s_p_i25_x_8h">
<area shape="rect" id="node4" href="_s_p_i_8h.html" title="Serial Peripheral Interface (SPI) Driver Interface. " alt="" coords="75,80,185,107"/>
</map>
</div>
</div>
<p><a href="_n_v_s_s_p_i25_x_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html">NVSSPI25X_HWAttrs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">NVSSPI25X attributes.  <a href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_n_v_s_s_p_i25_x___object.html">NVSSPI25X_Object</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a89a4a07b7be073b897feebf4760f1662"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_n_v_s_s_p_i25_x_8h.html#a89a4a07b7be073b897feebf4760f1662">NVSSPI25X_CMD_MASS_ERASE</a>&#160;&#160;&#160;(<a class="el" href="group___n_v_s___c_o_n_t_r_o_l.html#gaa9fa1c41660d17139bce63ff34cd774f">NVS_CMD_RESERVED</a> + 0)</td></tr>
<tr class="memdesc:a89a4a07b7be073b897feebf4760f1662"><td class="mdescLeft">&#160;</td><td class="mdescRight">Command to perform mass erase of entire flash.  <a href="#a89a4a07b7be073b897feebf4760f1662">More...</a><br /></td></tr>
<tr class="separator:a89a4a07b7be073b897feebf4760f1662"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf8ed123f5292601fe76a62275bb60f9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_n_v_s_s_p_i25_x_8h.html#abf8ed123f5292601fe76a62275bb60f9">NVSSPI25X_SPI_MANAGES_CS</a>&#160;&#160;&#160;((uint16_t)(~0))</td></tr>
<tr class="memdesc:abf8ed123f5292601fe76a62275bb60f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable internal management of SPI chip select.  <a href="#abf8ed123f5292601fe76a62275bb60f9">More...</a><br /></td></tr>
<tr class="separator:abf8ed123f5292601fe76a62275bb60f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a105e78ab0c157b8ad847af271b05b18c"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="struct_n_v_s___fxn_table.html">NVS_FxnTable</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_n_v_s_s_p_i25_x_8h.html#a105e78ab0c157b8ad847af271b05b18c">NVSSPI25X_fxnTable</a></td></tr>
<tr class="separator:a105e78ab0c157b8ad847af271b05b18c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a89a4a07b7be073b897feebf4760f1662"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89a4a07b7be073b897feebf4760f1662">&sect;&nbsp;</a></span>NVSSPI25X_CMD_MASS_ERASE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NVSSPI25X_CMD_MASS_ERASE&#160;&#160;&#160;(<a class="el" href="group___n_v_s___c_o_n_t_r_o_l.html#gaa9fa1c41660d17139bce63ff34cd774f">NVS_CMD_RESERVED</a> + 0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Command to perform mass erase of entire flash. </p>
<p>As this command can erase flash memory outside the region associated with the NVS_Handle passed to the control command, the user must carefully orchestrate the use of the command.</p>
<p>Mass Erase is the only control command supported. </p>

</div>
</div>
<a id="abf8ed123f5292601fe76a62275bb60f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf8ed123f5292601fe76a62275bb60f9">&sect;&nbsp;</a></span>NVSSPI25X_SPI_MANAGES_CS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NVSSPI25X_SPI_MANAGES_CS&#160;&#160;&#160;((uint16_t)(~0))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable internal management of SPI chip select. </p>
<p>Some SPI peripherals can be configured to manage their own chip select. Setting the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html#ade20d02364fd0f77d795295f4b85d363">spiCsnGpioIndex</a> field of the <a class="el" href="struct_n_v_s_s_p_i25_x___h_w_attrs.html" title="NVSSPI25X attributes. ">NVSSPI25X_HWAttrs</a> structure to <a class="el" href="_n_v_s_s_p_i25_x_8h.html#abf8ed123f5292601fe76a62275bb60f9" title="Disable internal management of SPI chip select. ">NVSSPI25X_SPI_MANAGES_CS</a> informs the NVSSPI25X driver that the SPI peripheral used by the NVS driver is configured to manage its own chip select signal. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a105e78ab0c157b8ad847af271b05b18c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a105e78ab0c157b8ad847af271b05b18c">&sect;&nbsp;</a></span>NVSSPI25X_fxnTable</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="struct_n_v_s___fxn_table.html">NVS_FxnTable</a> NVSSPI25X_fxnTable</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><small>
  <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2019</a>, Texas Instruments Incorporated. All rights reserved. <br>
  <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>
</small>
</body>
</html>
